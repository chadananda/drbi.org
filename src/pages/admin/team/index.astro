---
export const prerender = false;

import Layout from '@layouts/AdminLayout.astro';
import site from '@data/site.json';
import { getTeamWithRole, transformS3Url } from '@utils/utils.js';

// transformS3Url = (url = '', width = null, height = null, format = 'webp', quality=0)

const user  = Astro.locals?.user
// this page is only for admins
if (!['admin','superadmin'].includes(user?.role)) return Astro.redirect('/admin');


// add small image
const imgSm = (url) => transformS3Url(url, 80, 80);
const teamMembers  = (await getTeamWithRole()).map(member => ({...member, image_sm: imgSm(member.image_src)}));


// console.log(JSON.stringify(teamMembers, null, 2))

---
<Layout user={user}>
  <div class="max-w-6xl mx-auto px-6 py-6">
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-2">
        <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
          <span class="text-white text-xl">ðŸ‘¥</span>
        </div>
        <h1 class="text-2xl font-bold text-gray-900">Team Management</h1>
      </div>
      <nav class="text-sm text-gray-500 mb-6">
        <a href="/" class="hover:text-blue-600">home</a> / 
        <a href="/admin" class="hover:text-blue-600">admin</a> / team
      </nav>
      
      <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
        <p class="text-gray-700">
          The team for any website is divided by roles and responsibilities. Admins will be able to see the "Site Planning" tools, Editors the "Promotion Tasks" and Writers the content. One SuperAdmin is seeded into the database from the core branding file (<code class="bg-gray-100 px-1 py-0.5 rounded text-sm">src/data/site.json</code>). The superuser can be modified but not deleted.
        </p>
      </div>
      
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Your Website Team:</h2>
    </div>


    <div class="mb-8">
      {teamMembers.map(member => (
        <div class="relative bg-white border border-gray-200 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 mb-6">
          <div class="flex items-start gap-6">
            <div class="flex-shrink-0">
              <img src={member.image_sm} alt={member.image_alt} class="rounded-full h-20 w-20 object-cover" />
              <span class="inline-block bg-gray-100 text-xs text-gray-600 px-3 py-1 rounded-full mt-2">
                {member.role}
              </span>
            </div>
            
            <div class="flex-grow min-w-0">
              <h3 class="text-lg font-semibold text-gray-900 mb-1">{member.name}</h3>
              <p class="text-sm text-gray-600 mb-2">{member.title}</p>
              <p class="text-sm mb-2">
                <a href={`mailto:${member.email}`} class="text-blue-600 hover:text-blue-800 transition-colors">
                  {member.email}
                </a>
              </p>
              <p class="text-sm text-gray-700">{member.description}</p>
            </div>
            
            <div class="flex-shrink-0">
              <a 
                href={`/admin/team/${member.id}`} 
                class="inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-md hover:bg-blue-500 hover:text-white transition-colors duration-200"
                title="Edit team member"
              >
                âœŽ Edit
              </a>
            </div>
          </div>
        </div>
      ))}
    </div>

    <div class="flex justify-center">
      <a 
        href="/admin/team/adduser" 
        class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200"
      >
        <span class="mr-2">+</span>
        Add Team Member
      </a>
    </div>
  </div>
</Layout>


